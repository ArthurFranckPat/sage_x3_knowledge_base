# Module Achats - Sage X3

[‚óÑ Retour √† l'INDEX](./INDEX.md)

---

## üìã Vue d'ensemble

Le **Module Achats** g√®re l'ensemble du cycle d'approvisionnement, depuis l'expression du besoin jusqu'√† la r√©ception des marchandises et la facturation fournisseur. Il comprend **66 tables** couvrant les demandes d'achat, les appels d'offres, les commandes fournisseurs, les r√©ceptions, les retours et la sous-traitance.

### Processus couverts

1. **Demandes d'achat (DA)** : Expression et validation des besoins
2. **Appels d'offres** : Consultation et comparaison des fournisseurs
3. **Commandes fournisseurs** : Passation et suivi des commandes
4. **R√©ceptions** : Contr√¥le et entr√©e en stock des marchandises
5. **Factures fournisseurs** : Contr√¥le et rapprochement 3 points
6. **Retours fournisseurs** : Gestion des non-conformit√©s
7. **Sous-traitance** : Ordres de sous-traitance industrielle
8. **Exp√©ditions et transport** : Gestion logistique des flux

---

## üìä Statistiques

- **Nombre total de tables** : 66
- **Codes d'activit√©** : PPR, DEB, STS, WRH, KAG, ANA, MMS
- **Tables principales** : PORDER, PRECEIPT, PREQUIS, PINVOICED
- **Tables transactionnelles** : 70% des tables

---

## üîë Table PORDER - Commandes d'achat

### Informations g√©n√©rales
| Propri√©t√© | Valeur |
|-----------|--------|
| **Table** | PORDER |
| **Abr√©viation** | POH |
| **Intitul√©** | Commandes d'achat |
| **Module** | Achats |
| **Code activit√©** | |

### Cl√©s et index
| Cl√© | Description | Homonymes |
|-----|-------------|-----------|
| POH0 | POHNUM | Non |
| POH1 | BPSNUM+ORDDAT+POHNUM | Non |
| POH2 | ORDDAT+POHNUM | Non |

### Colonnes d√©taill√©es

#### Identification et r√©f√©rences
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| POHNUM | No commande | VCR | | | |
| ORDREF | R√©f√©rence interne | A | 20 | | |
| ORDDAT | Date commande | D | | | |
| SINUM | No pi√®ce Int√©grale | A | 10 | | SMI |
| EXPNUM | Num√©ro Export | L | 8 | | |

#### Fournisseurs et adresses
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| BPSNUM | Fournisseur | BPR | | ‚ÜíBPARTNER | |
| BPSINV | Tiers facturant | BPR | | ‚ÜíBPARTNER | |
| BPRPAY | Tiers pay√© | BPR | | ‚ÜíBPARTNER | |
| BPAADD | Adresse | ADR | | | |
| BPAINV | Adresse facture | ADR | | | |
| BPAPAY | Adresse tiers pay√© | ADR | | | |
| BPOADD | Adresse exp√©diteur | ADR | | | |
| BPOADDLIG | Ligne adresse | ADL | | | |
| BPONAM | Raison sociale | NAM | | | |
| BPOCRY | Pays | CRY | | ‚ÜíTABCOUNTRY | |
| BPOCRYNAM | Nom pays | NCY | | | |
| BPOCTY | Ville | CTY | | | |
| BPOPOSCOD | Code postal | POS | | | |
| BPOSAT | Etat | SAT | | | |
| BPRNAM | Raison sociale | NAM | | | |

#### Organisation et sites
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| CPY | Soci√©t√© | CPY | | ‚ÜíCOMPANY | |
| POHFCY | Site commande | FCY | | ‚ÜíFACILITY | |
| RCPFCY | Site r√©ception | FCY | | ‚ÜíFACILITY | |
| INVFCY | Site facturation | FCY | | ‚ÜíFACILITY | |
| SALFCY | Site vente | FCY | | ‚ÜíFACILITY | |
| STOFCY | Site exp√©dition | FCY | | ‚ÜíFACILITY | |
| ORIFCY | Site origine | FCY | | ‚ÜíFACILITY | |
| BETFCY | Inter-site | M | 4 | | |
| BETCPY | Inter-soci√©t√©s | M | 4 | | |

#### Devises et taux
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| CUR | Devise | CUR | | ‚ÜíTABCUR | |
| CHGCOE | Cours | RCU | | | |
| CHGTYP | Type cours | M | 15 | | |

#### Montants et totaux
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| TOTORD | Total HT commande | MD1 | | | |
| TOTORDL | Total HT devise soc | MD1 | | | |
| TTVORD | Total TTC commande | MD1 | | | |
| TTVORDL | Total TTC devise soc | MD1 | | | |
| TOTLINAMT | Total HT lignes | MD1 | | | |
| TOTLINATI | Total TTC lignes | MD1 | | | |
| TOTLINQTY | Total qt√©s lignes | DCB | 11.6 | | |
| TOTLINWEU | Total poids lignes | QTY | | | |
| TOTLINVOU | Total volumes lignes | QTY | | | |
| TOTTAXAMT | Total taxes | MD1 | | | |
| ORDMAXAMT | Mt maxi commande | MD1 | | | |
| TOTVLT | Total HT pr√©vu | MD1 | | | |

#### Statuts et compteurs
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| CLEFLG | Sold√©e | M | 4 | | |
| RCPFLG | Re√ßue | M | 15 | | |
| INVFLG | Factur√©e | M | 15 | | |
| APPFLG | Sign√©e | M | 15 | | |
| PRNFLG | Imprim√©e | M | 4 | | |
| LINNBR | Nombre lignes | C | 4 | | |
| CLELINNBR | Nb lignes sold√©es | C | 4 | | |
| RCPLINNBR | Nb lig r√©ceptionn√©es | C | 4 | | |
| INVLINNBR | Nb lignes factur√©es | C | 4 | | |
| FBULINNBR | Nb lig hors budget | C | 4 | | |
| RCPNBR | Nombre r√©ceptions | L | 8 | | |
| INVNBR | Nombre factures | L | 8 | | |

#### Type et cat√©gorie
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| POHTYP | Type commande | M | 20 | | |
| PURTYP | Type achat | M | 15 | | |
| SOHCAT | Cat√©gorie commande | M | 15 | | |

#### Dates de validit√©
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| STRDAT | Date d√©but validit√© | D | | | |
| ENDDAT | Date fin validit√© | D | | | |
| EXTRCPDAT1 | Date r√©cept pr√©vue | D | | | |

#### Livraison et transport
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| MDL | Mode livraison | MDL | | ‚ÜíTABMODELIV | |
| BPTNUM | Transporteur | BPT | | ‚ÜíBPCARRIER | |
| FFWNUM | Transitaire | BPT | | ‚ÜíBPCARRIER | |
| FFWADD | Adresse transitaire | ADR | | | |
| DME | Livraison partielle | M | 15 | | |
| EECICT | Incoterm | ICT | | ‚ÜíINCOTERM | |
| ICTCTY | Ville Incoterm | CTY | | | |

#### Conditions commerciales
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| PTE | Condition paiement | PTE | | ‚ÜíTABPAYTERM | |
| DEP | Escompte | TDA | | ‚ÜíTABDEPAGIO | |
| DISCRGTYP | Type de remise/frais | M | 10 | | PPR |

#### √âl√©ments de pied (PPR)
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| INVDTALIN1 | Elt fact lig tarif | PFI | | ‚ÜíPFOOTINV | PPR |
| INVDTALIN2 | Elt fact lig r√©part | PFI | | ‚ÜíPFOOTINV | |
| INVDTAVAT1 | Taxe lig tarif | VAT | | ‚ÜíTABVAT | PPR |
| INVDTAVAT2 | Taxe lig r√©part | VAT | | ‚ÜíTABVAT | |

#### Taxes
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| VACBPR | R√©gime taxe | TVB | | ‚ÜíTABVACBPR | |
| VACTYP | Type de r√©gime taxe | C | 1 | | |

#### DEB (D√©claration d'√©changes de biens)
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| EECICT | Incoterm | ICT | | ‚ÜíINCOTERM | |
| EECLOC | Lieu transport DEB | M | 15 | | DEB |
| EECNUM | Identification UE | A | 20 | | DEB |

#### Analytique
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| DIE | Code axe | DIE | | ‚ÜíGDIE | ANA |
| CCE | Section | CCE | | ‚ÜíCACCE | ANA |
| PJTH | Affaire | PJT | | ‚ÜíPIMPL | |

#### Acheteur et relances
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| BUY | Acheteur | AUS | | ‚ÜíAUTILIS | |
| FUPFLG | Relance livraisons | M | 4 | | |

#### Conteneurs et regroupement
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| TCTRNUM | Contenant | TCTR | | ‚ÜíTABCONTAINER | |
| TCTRQTY | Nb contenants | C | 4 | | |
| GPGCOD | Code regroupement | A | 20 | | |

#### Poids et volumes
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| VOLCAP | Volume | QTY | | | |
| WEICAP | Poids | QTY | | | |
| DSPVOU | Unit√© Volume | UOM | | ‚ÜíTABUNIT | |
| DSPWEU | Unit√© poids | UOM | | ‚ÜíTABUNIT | |

#### Accus√© de r√©ception (OCN)
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| OCNFLG | Relance ARC | M | 4 | | |
| OCNNUM | Num√©ro ARC | A | 20 | | |
| OCNDAT | Date ARC | D | | | |
| OCNREM | Observations ARC | A | 150 | | |

#### Textes et documents
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| TEX1 | Texte | TXC | | | |
| TEX2 | Texte | TXC | | | |

#### Statistiques
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| TSSCOD | Famille statistique | ADI | | ‚ÜíATABDIV | STS |

#### Lien client
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| BPCORD | Client commande | BPR | | ‚ÜíBPARTNER | |

#### Adresses d√©tails (suite)
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| CRY | Pays | CRY | | ‚ÜíTABCOUNTRY | |
| CRYNAM | Nom pays | NCY | | | |
| CTY | Ville | CTY | | | |
| POSCOD | Code postal | POS | | | |
| SAT | Etat | SAT | | | |

#### Audit et tra√ßabilit√©
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| CREDAT | Date cr√©ation | D | | | |
| CREDATTIM | Date heure | ADATIM | | | |
| CREUSR | Op√©rateur cr√©ation | A | 5 | | |
| UPDDAT | Date modification | D | | | |
| UPDDATTIM | Date heure | ADATIM | | | |
| UPDUSR | Op√©rateur modif | A | 5 | | |
| AUUID | Identifiant unique | AUUID | | | |

---

## üîë Table PRECEIPT - R√©ceptions

### Informations g√©n√©rales
| Propri√©t√© | Valeur |
|-----------|--------|
| **Table** | PRECEIPT |
| **Abr√©viation** | PTH |
| **Intitul√©** | R√©ception |
| **Module** | Achats |
| **Code activit√©** | |

### Cl√©s et index
| Cl√© | Description | Homonymes | Act |
|-----|-------------|-----------|-----|
| PTH0 | PTHNUM | Non | |
| PTH1 | BPSNDE | Oui | |
| PTH2 | BPSNUM+RCPDAT | Oui | |
| PTH3 | RCPDAT+PTHNUM | Non | |
| PTH4 | CPY+EECNUMDEB+RCPDAT | Oui | DEB |

### Colonnes principales (s√©lection)
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| PTHNUM | No r√©ception | VCR | | | |
| RCPDAT | Date r√©ception | D | | | |
| ARVDAT | Date arriv√©e | D | | | |
| NDEDAT | Date Bon livraison | D | | | |
| BPSNUM | Fournisseur | BPR | | ‚ÜíBPARTNER | |
| BPSNDE | No Bl fournisseur | A | 20 | | |
| BPSINV | Fourn facturant | BPR | | ‚ÜíBPARTNER | |
| BPRPAY | Tiers pay√© | BPR | | ‚ÜíBPARTNER | |
| PRHFCY | Site r√©ception | FCY | | ‚ÜíFACILITY | |
| CPY | Soci√©t√© | CPY | | ‚ÜíCOMPANY | |
| CUR | Devise | CUR | | ‚ÜíTABCUR | |
| INVFLG | Factur√©e | M | 15 | | |
| PSTFLG | Comptabilis√©e | M | 4 | | |
| PRNFLG | Imprim√©e | M | 4 | | |
| LINNBR | Nombre lignes | C | 4 | | |
| INVLINNBR | Nb lig total fact | C | 4 | | |
| INVLINCTR | Nb lignes factur√©es | C | 4 | | |
| PSTLINNBR | Nb lignes compta | C | 4 | | |
| TOTLINAMT | Total HT lignes | MD1 | | | |
| TOTAMTNOT | Total HT | MD1 | | | |
| TOTAMTATI | Total TTC | MD1 | | | |
| TOTTAXAMT | Total taxes | MD1 | | | |
| ENTCOD | Code pi√®ce auto | GAU | | ‚ÜíGAUTACE | |
| TRSCOD | Code mouvement | ADI | | ‚ÜíATABDIV | |
| PJTH | Affaire | PJT | | ‚ÜíPIMPL | |
| WRHE | D√©p√¥t | WRH | | ‚ÜíWAREHOUSE | WRH |

> **Note** : PRECEIPT contient plus de 100 colonnes similaires √† PORDER pour adresses, transport, DEB, etc.

---

## üîë Table PREQUIS - Demandes d'achat

### Informations g√©n√©rales
| Propri√©t√© | Valeur |
|-----------|--------|
| **Table** | PREQUIS |
| **Abr√©viation** | PSH |
| **Intitul√©** | Demandes d'achat |
| **Module** | Achats |
| **Code activit√©** | |

### Cl√©s et index
| Cl√© | Description | Homonymes | Act |
|-----|-------------|-----------|-----|
| PSH0 | PSHNUM | Non | |
| PSH1 | PSHFCY+PSHNUM | Non | |
| PSH2 | PRQDAT+PSHNUM | Non | |
| PSH3 | PSHNUMMMS+PSHNUM | Non | MMS |

### Colonnes d√©taill√©es
| Colonne | Intitul√© | Type | Long | Lien | Act |
|---------|----------|------|------|------|-----|
| PSHNUM | No demande | VCR | | | |
| PRQDAT | Date demande | D | | | |
| PSHFCY | Site demande | FCY | | ‚ÜíFACILITY | |
| CPY | Soci√©t√© | CPY | | ‚ÜíCOMPANY | |
| REQUSR | Demandeur | AUS | | ‚ÜíAUTILIS | |
| APPFLG | Sign√©e | M | 15 | | |
| CLEFLG | Sold√©e | M | 4 | | |
| ORDFLG | Command√©e | M | 4 | | |
| PRNFLG | Imprim√©e | M | 4 | | |
| LINNBR | Nombre lignes | C | 4 | | |
| CLELINNBR | Nb lignes sold√©es | C | 4 | | |
| ORDLINNBR | Nb lignes command√©es | C | 4 | | |
| APPLINNBR | Nb lignes sign√©es | C | 4 | | |
| FBULINNBR | Nb lig hors budget | C | 4 | | |
| TOTPRQ | Total demande HT | MD1 | | | |
| DIE | Code axe | DIE | | ‚ÜíGDIE | ANA |
| CCE | Section analytique | CCE | | ‚ÜíCACCE | ANA |
| PJTH | Affaire | PJT | | ‚ÜíPIMPL | |
| PSHNUMMMS | No maintenance | A | 15 | | |
| MMSURL | URL maintenance | A | 250 | | |
| ATECORI | Origine | M | 15 | | |
| TEX1 | Texte | TXC | | | |
| TEX2 | Texte | TXC | | | |
| EXPNUM | Num√©ro export | L | 8 | | |
| CREDAT | Date cr√©ation | D | | | |
| CREDATTIM | Date heure | ADATIM | | | |
| CREUSR | Op√©rateur cr√©ation | A | 5 | | |
| UPDDAT | Date modification | D | | | |
| UPDDATTIM | Date heure | ADATIM | | | |
| UPDUSR | Op√©rateur modif | A | 5 | | |
| AUUID | Identifiant unique | AUUID | | | |

---

## üìë Liste compl√®te des tables

### Demandes d'achat (Purchase Requisition)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PREQUIS | PSH | Demandes d'achat | |
| PREQUISD | PSD | Demandes d'achat D√©tail | |
| PREQUISA | PSA | Demandes d'achat Lien | |
| PREQUISO | PSO | Demandes d'achat Lien | |

### Appels d'offres (RFQ - Request For Quotation)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PQUOTAT | PQH | Appels d'offres | |
| PQUOTATD | PQD | Appels d'offre D√©tail article | |
| PQUOTATF | PQF | Appels d'offre detail fourn | |
| PRESP | PPH | R√©ponses appels d'offre | |
| PRESPD | PPD | R√©ponses appels d'offre D√©tail | |

### Commandes d'achat (Purchase Order)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PORDER | POH | Commandes d'achat | |
| PORDERP | POP | Commandes d'achat Prix | |
| PORDERQ | POQ | Commandes d'achat quantit√©s | |
| PORDERC | POC | Commandes d'achat cumul av-ret | |
| PORDITM | POI | Commandes d'achat par article | |
| BITMPPORDERP | BIPOP | Commandes d'achat Prix | |
| BITMPPORDERQ | BIPOQ | Commandes d'achat quantit√©s | |

### R√©ceptions (Purchase Receipt)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PRECEIPT | PTH | R√©ception | |
| PRECEIPTD | PTD | R√©ceptions D√©tail | |
| PWRKPTH | PWH | R√©ception temporaire | |
| PWRKPTD | PWD | R√©ceptions D√©tail temporaire | |

### Retours fournisseurs

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PRETURN | PNH | Retours | |
| PRETURND | PND | Retours D√©tail | |
| PWRKPNH | PWE | Retour temporaire | |
| PWRKPND | PWR | D√©tail ligne retour temporaire | |

### Factures fournisseurs (Purchase Invoice)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PINVOICED | PID | Factures d'achat d√©tail | |
| PINVOICEV | PIV | Factures d'achat valorisation | |

### Sous-traitance (Subcontracting)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| SCOHEAD | SCO | Ordre de sous-traitance | |
| SCOITM | SCI | Ordre de sous-traitance | |
| SCOMAT | SCM | Ordre sous-traitance Mati√®res | |
| SCOSRV | SCS | Ordre sous-traitance Service | |
| SCOTRK | SCK | Suivi de sous-traitance | |
| PWRKSTT | PWS | Sous-traitance | |

### Transport et exp√©ditions

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| SHIPMENT | SHH | Exp√©dition | |
| SHIPMENTD | SHD | Exp√©dition d√©tail | |
| SHIPDOC | SHIPD | Documents exp√©dition | |
| SHIPTRACK | SHIPT | Suivi logistique exp√©dition | |
| TRANSPORT | TRNP | Transport | |
| EVENTTRNP | EVT | Transport incident | |
| CONTAINER | CTRH | Conteneur fret | |
| CONTAINERD | CTRD | Conteneur fret d√©tail | |

### Tarifs et prix

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PPRICLINK | PPK | Recherche tarifs achat (link) | |
| PPRIVARWRK | PPV | Etat √©cart prix achat | |

### Co√ªts et rapprochements

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| COSTSTCD | STCD | Structure de co√ªts - documents | |
| COSTSTCR | STCR | Rapprochement charges | |
| MATCHTOL | MAT | R√®gle rapprochement | |

### √âl√©ments de pied et taxes

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PVCRFOOT | PVF | Document achats - Elt pied | |
| PVCRVAT | PVV | Document achats - Taxes | |

### Historiques

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| UPORDER | UOH | Histo. commandes d'achat | |
| UPORDERC | UOC | Histo. cdes achat cumul av-ret | |
| UPORDERP | UOP | Histo. cdes d'achat Prix | |
| UPORDERQ | UOQ | Histo. cdes d'achat qt√©s | |

### Tables de travail (Temporaires)

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PWRKORDERS | PWO | Besoins pris en compte | |
| PWRKPOC | PWC | Article-contrat temporaire | |
| PWRKPOP | PWP | Article-contrat temporaire | |
| PWRKPOQ | PWQ | D√©tail commande temporaire | |
| PWRKPQF | PWF | AOF ADR Fournis. temporaire | |
| WRKPURFCS | WPF | Etat charges achats | |
| TMPPRPT | TPRPT | Table temporaire impression | |

### Transactions et r√©gularisations

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PURTRS | PTR | Transaction de saisie achats | |
| PTDSTKVAL | PSV | R√©gularisation | |

### Wipcost

| Table | Abr√©viation | Intitul√© | Code activit√© |
|-------|-------------|----------|---------------|
| PARWIPACCS | SWA | Param√®tre Wipcost-Interface | |

---

## üîó Relations principales

### PREQUIS ‚Üí PORDER

**Demande d'achat ‚Üí Commande** (N ‚Üí N)
- **PREQUISD** : Lignes de demande d'achat
- Transformation des DA approuv√©es en commandes
- Liaison via tables temporaires et workflow d'approvisionnement

### PORDER ‚Üí Tables associ√©es

**Lignes de commandes** (1 ‚Üí N)
- **PORDERQ** : Quantit√©s et r√©f√©rences articles
  - POHNUM ‚Üí POHNUM
  - Contient ITMREF, EXTQTY, RCPQTY, INVQTY
- **PORDERP** : Prix et valorisations
  - POHNUM ‚Üí POHNUM
  - Contient prix unitaires, remises, montants
- **PORDERC** : Cumuls d'avancement
  - POHNUM ‚Üí POHNUM
  - Contient quantit√©s re√ßues, factur√©es, restantes

**R√©ceptions** (1 ‚Üí N)
- **PRECEIPT** : R√©ceptions de marchandises
  - Lien via PORDERQ (commande d'origine)
- **PRECEIPTD** : Lignes de r√©ception
  - Contient quantit√©s re√ßues, lots, contr√¥les qualit√©

**Factures** (1 ‚Üí N)
- **PINVOICED** : Lignes de facture fournisseur
  - Lien avec PORDER et PRECEIPT
- **PINVOICEV** : Valorisation des factures
  - Rapprochement 3 points : Commande/R√©ception/Facture

### PORDER ‚Üí Donn√©es de base

- **BPARTNER** : Fournisseur (N ‚Üí 1)
- **ITMMASTER** : Articles command√©s via PORDERQ (N ‚Üí N)
- **FACILITY** : Sites commande, r√©ception, facture (N ‚Üí 1)
- **COMPANY** : Soci√©t√© acheteuse (N ‚Üí 1)

### PORDER ‚Üí Comptabilit√©

- **GACCOUNT** : Comptes d'imputation
- **CACCE** : Sections analytiques
- G√©n√©ration d'√©critures lors de la r√©ception (engagement) et facturation

---

## üîÑ Cycle de vie d'une Commande d'achat

### 1. Demande d'achat
```
Table : PREQUIS
- Cr√©ation par demandeur
- APPFLG = Non (non sign√©e)
- Validation/Signature
- APPFLG = Oui
- Transformation en commande
```

### 2. Appel d'offres (optionnel)
```
Table : PQUOTAT, PRESP
- Consultation fournisseurs
- Collecte des r√©ponses
- Analyse comparative
- S√©lection du fournisseur
```

### 3. Cr√©ation de commande
```
Table : PORDER
- CLEFLG = Non (non sold√©e)
- RCPFLG = Non (non re√ßue)
- INVFLG = Non (non factur√©e)
- Validation et envoi fournisseur
- PRNFLG = Oui (imprim√©e)
```

### 4. R√©ception des marchandises
```
Table : PRECEIPT
- Contr√¥le quantitatif et qualitatif
- Mise √† jour PORDERQ (RCPQTY)
- Mise √† jour PORDERC (cumuls)
- Entr√©e en stock via STOCK
- PORDER.RCPFLG = Partiellement re√ßue ou Re√ßue
```

### 5. Facturation
```
Table : PINVOICED
- R√©ception facture fournisseur
- Rapprochement 3 points :
  * Commande (PORDER)
  * R√©ception (PRECEIPT)
  * Facture (PINVOICED)
- Tol√©rance de rapprochement (MATCHTOL)
- Mise √† jour PORDERQ (INVQTY)
- PORDER.INVFLG = Partiellement factur√©e ou Factur√©e
```

### 6. Cl√¥ture
```
- Toutes les lignes r√©ceptionn√©es et factur√©es
- PORDER.CLEFLG = Oui
- Archivage dans UPORDER
```

---

## üìä Statuts des Commandes (flags)

### CLEFLG - Statut de solde
| Valeur | Description |
|--------|-------------|
| **Non** | Commande ouverte |
| **Oui** | Commande sold√©e |

### RCPFLG - Statut de r√©ception
| Valeur | Description |
|--------|-------------|
| **Non** | Non re√ßue |
| **Partiellement re√ßue** | R√©ceptions partielles |
| **Re√ßue** | Totalement re√ßue |

### INVFLG - Statut de facturation
| Valeur | Description |
|--------|-------------|
| **Non** | Non factur√©e |
| **Partiellement factur√©e** | Factures partielles |
| **Factur√©e** | Totalement factur√©e |

### APPFLG - Statut de signature
| Valeur | Description |
|--------|-------------|
| **Non** | Non sign√©e |
| **Partiellement sign√©e** | Validation partielle |
| **Sign√©e** | Totalement valid√©e |

---

## üí° Cas d'usage courants

### 1. Commandes en attente de r√©ception
```sql
SELECT POHNUM, BPSNUM, ORDDAT, TOTORD, RCPFLG
FROM PORDER
WHERE RCPFLG IN ('Non', 'Partiellement re√ßue')
  AND CLEFLG = 'Non'
  AND ORDDAT >= '2024-01-01'
ORDER BY ORDDAT
```

### 2. √âcart Commande/R√©ception
```sql
SELECT 
  PQ.POHNUM,
  PQ.ITMREF,
  PQ.EXTQTY AS QteCommandee,
  PQ.RCPQTY AS QteRecue,
  (PQ.EXTQTY - PQ.RCPQTY) AS EcartQte
FROM PORDERQ PQ
  INNER JOIN PORDER PO ON PQ.POHNUM = PO.POHNUM
WHERE PQ.EXTQTY <> PQ.RCPQTY
  AND PO.CLEFLG = 'Non'
```

### 3. Rapprochement 3 points
```sql
SELECT 
  PO.POHNUM,
  PQ.ITMREF,
  PQ.EXTQTY AS QteCmd,
  PQ.RCPQTY AS QteRecu,
  PQ.INVQTY AS QteFacturee,
  PP.NETPRI AS PrixCmd,
  PI.NETPRI AS PrixFacture,
  (PI.NETPRI - PP.NETPRI) AS EcartPrix
FROM PORDER PO
  INNER JOIN PORDERQ PQ ON PO.POHNUM = PQ.POHNUM
  INNER JOIN PORDERP PP ON PQ.POHNUM = PP.POHNUM AND PQ.POPLIN = PP.POPLIN
  INNER JOIN PINVOICED PI ON PQ.POHNUM = PI.POHNUM AND PQ.POPLIN = PI.POPLIN
WHERE ABS(PI.NETPRI - PP.NETPRI) > 0.01
```

### 4. D√©lai de livraison moyen par fournisseur
```sql
SELECT 
  PO.BPSNUM,
  AVG(DATEDIFF(day, PO.ORDDAT, PT.RCPDAT)) AS DelaiMoyenJours,
  COUNT(DISTINCT PT.PTHNUM) AS NbReceptions
FROM PORDER PO
  INNER JOIN PRECEIPT PT ON PO.BPSNUM = PT.BPSNUM
WHERE PT.RCPDAT >= '2024-01-01'
GROUP BY PO.BPSNUM
ORDER BY DelaiMoyenJours
```

### 5. Commandes sans r√©ception depuis 30 jours
```sql
SELECT POHNUM, BPSNUM, ORDDAT, TOTORD
FROM PORDER
WHERE RCPFLG = 'Non'
  AND CLEFLG = 'Non'
  AND ORDDAT < DATEADD(day, -30, GETDATE())
ORDER BY ORDDAT
```

---

## ‚ö†Ô∏è Points d'attention

### Performance

1. **Index critiques** :
   - PORDER : POHNUM (cl√© primaire), BPSNUM+ORDDAT+POHNUM, ORDDAT+POHNUM
   - PORDERQ : POHNUM+POPLIN pour jointures
   - PRECEIPT : PTHNUM, BPSNUM+RCPDAT, RCPDAT+PTHNUM

2. **Volum√©trie** :
   - PORDERQ/PORDERP/PORDERC : Tr√®s volumineuses (autant de lignes que d'articles command√©s)
   - PRECEIPTD : Volume important sur les sites √† fort flux de r√©ception
   - PINVOICED : Historique de toutes les factures

3. **Archivage** :
   - Archiver les commandes anciennes dans UPORDER
   - Supprimer les tables temporaires PWRK* r√©guli√®rement

### Int√©grit√© des donn√©es

1. **Coh√©rence des quantit√©s** :
   - PORDERQ.EXTQTY = RCPQTY + RETQTY + RMNQTY
   - PORDERQ.INVQTY ‚â§ RCPQTY (on ne peut facturer plus que ce qui est re√ßu)

2. **Rapprochement 3 points** :
   - V√©rifier les r√®gles de tol√©rance (MATCHTOL)
   - Contr√¥ler les √©carts prix entre commande et facture
   - Valider les √©carts de quantit√©

3. **Statuts coh√©rents** :
   - Si RCPLINNBR = LINNBR ‚Üí RCPFLG = 'Re√ßue'
   - Si INVLINNBR = LINNBR ‚Üí INVFLG = 'Factur√©e'
   - Si RCPFLG = 'Re√ßue' ET INVFLG = 'Factur√©e' ‚Üí Peut √™tre sold√©e

### Codes d'activit√©

| Code | Description |
|------|-------------|
| **PPR** | Structure de prix achats (√©l√©ments de pied) |
| **DEB** | D√©clarations d'√©changes de biens |
| **STS** | Statistiques achats |
| **WRH** | Gestion d'entrep√¥t / d√©p√¥ts |
| **KAG** | L√©gislation Argentine |
| **ANA** | Analytique |
| **MMS** | Lien avec GMAO (Maintenance) |

---

## üéì Bonnes pratiques

### Cr√©ation de commandes

1. **Partir des demandes d'achat valid√©es** pour tra√ßabilit√©
2. **Regrouper par fournisseur** pour optimiser les frais de port
3. **V√©rifier les budgets** avant validation (FBULINNBR)
4. **Renseigner les dates de livraison** souhait√©es
5. **Pr√©ciser les conditions** de paiement et escomptes

### R√©ception

1. **Contr√¥ler syst√©matiquement** :
   - Quantit√© vs commande
   - Qualit√© des produits
   - Conformit√© des r√©f√©rences

2. **G√©rer les √©carts** :
   - Sur-livraison : Cr√©er un avoir ou accepter
   - Sous-livraison : Relancer fournisseur ou solder
   - Non-conformit√© : Cr√©er un retour (PRETURN)

3. **Tracer les lots** pour tra√ßabilit√©
4. **Saisir rapidement** pour mise √† jour du stock

### Facturation

1. **Rapprocher 3 points** :
   - Commande ‚Üí R√©f√©rence et prix
   - R√©ception ‚Üí Quantit√© re√ßue
   - Facture ‚Üí Montant factur√©

2. **Respecter les tol√©rances** (MATCHTOL) :
   - Prix : ¬±X%
   - Quantit√© : ¬±Y unit√©s
   - Montant total : ¬±Z‚Ç¨

3. **Bloquer les factures** en cas d'√©cart important
4. **Valider avant comptabilisation**

### Cl√¥ture

1. **Ne solder que les commandes termin√©es** :
   - Toutes les lignes r√©ceptionn√©es OU
   - Reliquat accept√© avec accord fournisseur

2. **V√©rifier la facturation** :
   - Toutes les r√©ceptions factur√©es
   - Pas d'√©cart en attente

3. **Documenter les sold√©s partiels** (TEX1, TEX2)

---

## üìà Indicateurs de performance (KPI)

### D√©lai de livraison
```sql
SELECT 
  YEAR(PT.RCPDAT) AS Annee,
  MONTH(PT.RCPDAT) AS Mois,
  AVG(DATEDIFF(day, PO.ORDDAT, PT.RCPDAT)) AS DelaiMoyen,
  MIN(DATEDIFF(day, PO.ORDDAT, PT.RCPDAT)) AS DelaiMin,
  MAX(DATEDIFF(day, PO.ORDDAT, PT.RCPDAT)) AS DelaiMax
FROM PRECEIPT PT
  INNER JOIN PORDER PO ON PT.BPSNUM = PO.BPSNUM
WHERE PT.RCPDAT >= '2024-01-01'
GROUP BY YEAR(PT.RCPDAT), MONTH(PT.RCPDAT)
ORDER BY Annee, Mois
```

### Taux de service fournisseur
```sql
SELECT 
  PO.BPSNUM,
  COUNT(CASE WHEN PQ.EXTQTY = PQ.RCPQTY THEN 1 END) * 100.0 / COUNT(*) AS TauxService
FROM PORDER PO
  INNER JOIN PORDERQ PQ ON PO.POHNUM = PQ.POHNUM
WHERE PO.ORDDAT >= '2024-01-01'
  AND PO.RCPFLG IN ('Re√ßue', 'Partiellement re√ßue')
GROUP BY PO.BPSNUM
HAVING COUNT(*) > 10
ORDER BY TauxService DESC
```

### Analyse des √©carts de prix
```sql
SELECT 
  PI.ITMREF,
  COUNT(*) AS NbEcarts,
  AVG(PI.NETPRI - PP.NETPRI) AS EcartMoyen,
  SUM(PI.NETPRI - PP.NETPRI) AS EcartTotal
FROM PINVOICED PI
  INNER JOIN PORDERP PP ON PI.POHNUM = PP.POHNUM AND PI.POPLIN = PP.POPLIN
WHERE PI.NETPRI <> PP.NETPRI
  AND PI.INVDAT >= '2024-01-01'
GROUP BY PI.ITMREF
ORDER BY ABS(SUM(PI.NETPRI - PP.NETPRI)) DESC
```

---

## üîß Param√©trage recommand√©

### R√®gles de rapprochement (MATCHTOL)

1. **Tol√©rance sur prix** :
   - ¬±2% pour produits standards
   - ¬±5% pour produits √† cours variable
   - 0% pour immobilisations

2. **Tol√©rance sur quantit√©** :
   - ¬±5 unit√©s pour petites quantit√©s
   - ¬±2% pour grandes quantit√©s

3. **Tol√©rance sur montant total** :
   - ¬±100‚Ç¨ pour petites commandes
   - ¬±1% pour grandes commandes

### Types d'achat (PURTYP)

- **Standard** : Achat normal
- **Import** : Achat √† l'international
- **Stock** : R√©approvisionnement stock
- **Direct** : Achat direct pour vente/production
- **Investissement** : Immobilisations

### Workflow d'approbation

1. **Seuils de validation** :
   - < 500‚Ç¨ : Validation automatique
   - 500‚Ç¨ - 5000‚Ç¨ : Acheteur
   - 5000‚Ç¨ - 50000‚Ç¨ : Chef de service
   - > 50000‚Ç¨ : Direction

2. **Validation par budget** :
   - V√©rifier la disponibilit√© budg√©taire
   - Bloquer si hors budget (FBULINNBR)

---

[‚óÑ Retour √† l'INDEX](./INDEX.md)
