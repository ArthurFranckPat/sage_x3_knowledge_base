@layout('layouts/main')

@set('title', 'SQL Playground - Sage X3')

@section('content')
<div class="playground-container">
  
  <!-- Sidebar avec boutons d'action -->
  <aside class="sidebar">
    <button 
      class="btn-icon" 
      up-layer="new drawer" 
      up-href="/playground/schema" 
      up-size="large"
      up-accept-location="/playground/schema*"
      title="Schema Explorer">
      📊
    </button>
    
    <button 
      class="btn-icon"
      up-layer="new drawer" 
      up-href="/playground/history"
      up-size="large"
      title="History">
      📝
    </button>
    
    <button 
      class="btn-icon"
      up-layer="new drawer" 
      up-href="/playground/favorites"
      up-size="large"
      title="Favorites">
      ⭐
    </button>
    
    <div style="flex: 1"></div>
    
    <button 
      class="btn-icon"
      up-layer="new modal" 
      up-href="/playground/examples"
      up-size="medium"
      title="SQL Examples">
      💡
    </button>
  </aside>

  <!-- Section Éditeur SQL -->
  <section id="editor-section">
    <div class="editor-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2 style="font-size: 1.125rem; color: var(--text-primary);">📝 SQL Editor</h2>
      <div style="display: flex; gap: 0.5rem;">
        <button class="btn-icon" onclick="window.sqlEditor?.setValue('')" title="Clear editor">
          🗑️
        </button>
        <button class="btn-icon" onclick="formatSQL()" title="Format SQL (Ctrl+Shift+F)">
          ✨
        </button>
        <button 
          class="btn-icon"
          onclick="addToFavorites(window.sqlEditor?.getValue() || '')"
          title="Add to favorites">
          ⭐
        </button>
      </div>
    </div>
    
    <!-- Monaco Editor Container -->
    <div id="monaco-editor"></div>
    
    <!-- Actions -->
    <form 
      id="sql-form"
      up-submit 
      up-target="#results, #validation" 
      up-fail-target="#validation"
      method="POST" 
      action="/api/playground/execute">
      
      @csrfField()
      <input type="hidden" name="sql" id="sql-input">
      
      <div class="actions">
        <button type="submit" class="btn btn-primary" up-disable-with="⏳ Executing...">
          ▶️ Execute (Ctrl+Enter)
        </button>
        
        <button 
          type="button" 
          class="btn btn-secondary"
          up-validate 
          up-target="#validation"
          up-method="POST"
          up-url="/api/playground/validate"
          onclick="document.querySelector('#sql-input').value = window.sqlEditor?.getValue() || ''">
          ✓ Validate
        </button>
        
        <button 
          type="button" 
          class="btn btn-tertiary"
          onclick="window.sqlEditor?.setValue('SELECT * FROM itmmaster LIMIT 10')">
          🔄 Reset
        </button>
      </div>
    </form>
  </section>

  <!-- Zone de validation -->
  <div id="validation" up-hungry up-keep>
    @if(validation)
      @!component('playground/partials/validation', { validation })
    @end
  </div>

  <!-- Résultats -->
  <div id="results" up-hungry>
    @if(result)
      @!component('playground/partials/results', { result })
    @end
  </div>

</div>

<script>
  // Helper function for SQL formatting
  function formatSQL() {
    if (window.sqlEditor) {
      const sql = window.sqlEditor.getValue()
      // Trigger Ctrl+Shift+F command
      window.sqlEditor.trigger('keyboard', 'editor.action.formatDocument')
    }
  }
</script>
@end
