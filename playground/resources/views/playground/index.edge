<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SQL Playground - Sage X3</title>
  
  @vite(['resources/css/app.css', 'resources/js/app.js'])
  
  <style>
    [x-cloak] { display: none !important; }
    /* Show loader overlay while Unpoly is updating the results container */
    #results-container[up-loading] #results-loading { display: grid !important; }
    /* Toasts: stack from top to bottom */
    #toaster { flex-direction: column; }
  </style>
  <script>
    // Initialize theme without Alpine
    (function(){
      try {
        if (localStorage.getItem('theme') === 'dark') {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
      } catch (e) {}
    })()
  </script>
</head>
<body>
  <!-- App Shell (Basecoat utilities) -->
  <div class="min-h-screen grid grid-rows-[auto,1fr] bg-background">
    
    <!-- Header -->
    <header class="h-16 border-b bg-card flex items-center justify-between px-6">
      <div class="flex items-center gap-3 text-lg font-semibold">
        {{ svg('lucide:rocket', { width: 20, height: 20 }) }}
        <span>SQL Playground - Sage X3</span>
      </div>
      <div class="flex items-center gap-2">
        <button
          class="btn-ghost"
          onclick="showShortcuts()"
          title="Keyboard shortcuts (?)"
          aria-label="Keyboard shortcuts"
        >{{ svg('lucide:keyboard', { width: 18, height: 18 }) }}</button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="grid grid-cols-[64px_0.8fr_80px_1.2fr] gap-4 p-4 overflow-hidden">
      
      <!-- Sidebar -->
      <aside class="rounded-lg border bg-muted/50 p-2 flex flex-col items-center gap-3 h-[calc(100vh-120px)] min-h-[480px]">
        <a 
          href="/playground/schema"
          class="btn-ghost btn-icon-outline rounded-lg size-10 inline-flex items-center justify-center"
          up-layer="new drawer" 
          up-size="large"
          title="Schema Explorer"
          aria-label="Schema Explorer"
        >{{ svg('lucide:database', { width: 18, height: 18 }) }}</a>
        
        <a 
          href="/playground/history"
          class="btn-ghost btn-icon-outline rounded-lg size-10 inline-flex items-center justify-center"
          up-layer="new drawer" 
          up-size="large"
          title="History"
          aria-label="History"
        >{{ svg('lucide:history', { width: 18, height: 18 }) }}</a>
        
        <a 
          href="/playground/favorites"
          class="btn-ghost btn-icon-outline rounded-lg size-10 inline-flex items-center justify-center"
          up-layer="new drawer" 
          up-size="large"
          title="Favorites"
          aria-label="Favorites"
        >{{ svg('lucide:star', { width: 18, height: 18 }) }}</a>
      </aside>

      <!-- Editor Panel (Card) -->
      <section class="card h-[calc(100vh-120px)] min-h-[480px] overflow-hidden">
        <header>
          <h2 class="flex items-center gap-2">{{ svg('lucide:code-2', { width: 18, height: 18 }) }} <span>SQL Query</span></h2>
        </header>
        <section class="h-full">
          <div id="monaco-editor" class="h-full">
            <!-- Fallback textarea -->
            <textarea 
              id="sql-fallback-editor" 
              class="textarea h-full w-full"
              style="font-family: monospace; resize: none;"
              placeholder="Loading Monaco Editor...">SELECT * FROM itmmaster LIMIT 10</textarea>
          </div>
        </section>
        <footer class="hidden"></footer>
        
        <!-- Validation Section (kept for responses) -->
        <div class="mt-4" id="validation-container">
          <div id="validation" up-hungry up-keep x-ignore>
            @if(validation)
              @include('playground/partials/validation')
            @end
          </div>
        </div>

        <!-- Hidden form used by Execute button -->
        <form 
          id="sql-form"
          up-submit 
          up-target="#results-container, #validation-container" 
          up-fail-target="#validation-container"
          method="POST" 
          action="/api/playground/execute"
          onsubmit="return copyEditorToInput()"
        >
          {{ csrfField() }}
          <input type="hidden" name="sql" id="sql-input">
        </form>
      </section>

      <!-- Vertical Actions -->
      <div class="flex flex-col items-center justify-center gap-3 h-[calc(100vh-120px)] min-h-[480px]">
        <button
          type="submit"
          form="sql-form"
          up-submit
          up-target="#results-container, #validation-container"
          up-fail-target="#validation-container"
          formaction="/api/playground/execute"
          formmethod="POST"
          onclick="document.querySelector('#sql-input').value = (window.sqlEditor?.getValue() || document.querySelector('#sql-fallback-editor')?.value || '')"
          class="btn w-[88px] flex items-center justify-center bg-green-500 text-white hover:bg-green-600"
        >{{ svg('lucide:play', { width: 16, height: 16 }) }}</button>

        <!-- Save Form -->
        <form
          up-submit
          up-target="#history-list"
          method="POST"
          action="/api/playground/history"
          onsubmit="document.querySelector('#save-sql').value = (window.sqlEditor?.getValue() || document.querySelector('#sql-fallback-editor')?.value || '')"
        >
          {{ csrfField() }}
          <input type="hidden" name="sql" id="save-sql">
          <input type="hidden" name="rowCount" value="0">
          <input type="hidden" name="executionTime" value="0">
          <input type="hidden" name="validationScore" value="100">
          <button
            type="submit"
            class="btn w-[88px] flex items-center justify-center"
            title="Sauvegarder la requête actuelle"
          >{{ svg('lucide:save', { width: 16, height: 16 }) }}</button>
        </form>

        <button
          type="button"
          class="btn-destructive w-[88px]"
          onclick="window.sqlEditor?.setValue('SELECT * FROM itmmaster LIMIT 10')"
        >{{ svg('lucide:rotate-ccw', { width: 16, height: 16 }) }}</button>
      </div>

      <!-- Results Panel (Card) -->
      <section class="card h-[calc(100vh-120px)] min-h-[480px] overflow-hidden">
        <header>
          <h2 class="flex items-center gap-2">{{ svg('lucide:bar-chart-3', { width: 18, height: 18 }) }} <span>Resultat requête</span></h2>
        </header>
        <section class="h-full">
          <div id="results-container" class="relative h-full" x-ignore>
            <div id="results" up-hungry class="h-full">
              @if(result)
                @include('playground/partials/results')
              @else
                <div class="flex h-full items-center justify-center p-8">
                  <div class="text-center max-w-sm">
                    <div class="mx-auto mb-4 size-12 rounded-full bg-muted ring-1 ring-border flex items-center justify-center text-muted-foreground">
                      {{ svg('lucide:bar-chart-3', { width: 20, height: 20 }) }}
                    </div>
                    <div class="text-lg font-semibold">No results yet</div>
                    <p class="mt-1 text-sm text-muted-foreground">Execute a SQL query to see results here.</p>
                    <p class="mt-2 text-xs text-muted-foreground">
                      Press
                      <span class="inline-flex items-center rounded border px-1.5 py-0.5 text-[11px] leading-none bg-muted font-mono">Ctrl</span>
                      +
                      <span class="inline-flex items-center rounded border px-1.5 py-0.5 text-[11px] leading-none bg-muted font-mono">Enter</span>
                    </p>
                  </div>
                </div>
              @end
            </div>
            <div id="results-loading" class="hidden absolute inset-0 z-20 grid place-items-center bg-background/50">
              <div class="rounded-full p-3 bg-card/80 ring-1 ring-border text-muted-foreground">
                {{ svg('lucide:loader-2', { width: 22, height: 22, class: 'animate-spin' }) }}
              </div>
            </div>
          </div>
        </section>
        <footer class="hidden"></footer>
      </section>

    </main>
  </div>

  <!-- Basecoat toaster container -->
  <div id="toaster" class="toaster top-0 bottom-auto" data-align="center" aria-live="polite" aria-atomic="true"></div>

  <script>
    // Show shortcuts modal (to be implemented with modal component)
    function showShortcuts() {
      alert('Keyboard shortcuts:\nCtrl+Enter - Execute query\nCtrl+Shift+F - Format SQL')
    }
  </script>
</body>
</html>
