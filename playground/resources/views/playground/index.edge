<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SQL Playground - Sage X3</title>
  
  @vite(['resources/css/app.css', 'resources/js/app.js'])
</head>
<body>
  <div id="app">
    <!-- Header persistant -->
    <header id="header">
      <h1>🚀 Playground SQL - Sage X3</h1>
      <nav>
        <a href="/playground" up-target="#main-content" up-history="true">Playground</a>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
          <span class="dark-hidden">🌙</span>
          <span class="light-hidden">☀️</span>
        </button>
        <button class="btn-icon" onclick="showShortcuts()" title="Keyboard shortcuts (?)">
          ⌨️
        </button>
      </nav>
    </header>

    <!-- Contenu principal (remplacé par Unpoly) -->
    <main id="main-content" up-main>
      <div class="playground-container">
  
  <!-- Sidebar avec boutons d'action -->
  <aside class="sidebar">
    <button 
      class="btn-icon" 
      up-layer="new drawer" 
      up-href="/playground/schema" 
      up-size="large"
      up-accept-location="/playground/schema*"
      title="Schema Explorer">
      📊
    </button>
    
    <button 
      class="btn-icon"
      up-layer="new drawer" 
      up-href="/playground/history"
      up-size="large"
      title="History">
      📝
    </button>
    
    <button 
      class="btn-icon"
      up-layer="new drawer" 
      up-href="/playground/favorites"
      up-size="large"
      title="Favorites">
      ⭐
    </button>
    
    <div style="flex: 1"></div>
    
    <button 
      class="btn-icon"
      up-layer="new modal" 
      up-href="/playground/examples"
      up-size="medium"
      title="SQL Examples">
      💡
    </button>
  </aside>

  <!-- Section Éditeur SQL -->
  <section id="editor-section">
    <div class="editor-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2 style="font-size: 1.125rem; color: var(--text-primary);">📝 SQL Editor</h2>
      <div style="display: flex; gap: 0.5rem;">
        <button class="btn-icon" onclick="window.sqlEditor?.setValue('')" title="Clear editor">
          🗑️
        </button>
        <button class="btn-icon" onclick="formatSQL()" title="Format SQL (Ctrl+Shift+F)">
          ✨
        </button>
        <button 
          class="btn-icon"
          onclick="addToFavorites(window.sqlEditor?.getValue() || '')"
          title="Add to favorites">
          ⭐
        </button>
      </div>
    </div>
    
    <!-- Monaco Editor Container -->
    <div id="monaco-editor" style="min-height: 300px; border: 1px solid var(--border-color);">
      <!-- Fallback textarea while Monaco loads -->
      <textarea 
        id="sql-fallback-editor" 
        style="width: 100%; height: 300px; font-family: monospace; padding: 10px; border: none; resize: vertical;"
        placeholder="Loading Monaco Editor...">SELECT * FROM itmmaster LIMIT 10</textarea>
    </div>
    
    <!-- Actions (kept outside Unpoly target zones) -->
    <form 
      id="sql-form"
      up-submit 
      up-target="#results-container, #validation-container" 
      up-fail-target="#validation-container"
      method="POST" 
      action="/api/playground/execute"
      onsubmit="return copyEditorToInput()">
      
      {{ csrfField() }}
      <input type="hidden" name="sql" id="sql-input">
      
      <div class="actions" up-keep>
        <button type="submit" class="btn btn-primary" up-disable-with="⏳ Executing...">
          ▶️ Execute (Ctrl+Enter)
        </button>
        
        <button 
          type="button" 
          class="btn btn-secondary"
          up-validate 
          up-target="#validation-container"
          up-method="POST"
          up-url="/api/playground/validate"
          onclick="document.querySelector('#sql-input').value = window.sqlEditor?.getValue() || ''">
          ✓ Validate
        </button>
        
        <button 
          type="button" 
          class="btn btn-tertiary"
          onclick="window.sqlEditor?.setValue('SELECT * FROM itmmaster LIMIT 10')">
          🔄 Reset
        </button>
      </div>
    </form>
  </section>

  <!-- Zone de validation (container prevents button removal) -->
  <div id="validation-container">
    <div id="validation" up-hungry up-keep>
      @if(validation)
        @include('playground/partials/validation')
      @end
    </div>
  </div>

  <!-- Résultats (container prevents button removal) -->
  <div id="results-container">
    <div id="results" up-hungry>
      @if(result)
        @include('playground/partials/results')
      @end
    </div>
  </div>

</div>

<script>
  // Helper function for SQL formatting
  function formatSQL() {
    if (window.sqlEditor) {
      const sql = window.sqlEditor.getValue()
      // Trigger Ctrl+Shift+F command
      window.sqlEditor.trigger('keyboard', 'editor.action.formatDocument')
    }
  }
</script>
      </div>
    </main>
  </div>

  <style>
    .dark-hidden { display: none; }
    .dark .dark-hidden { display: inline; }
    .dark .light-hidden { display: none; }
    .light-hidden { display: inline; }
  </style>
</body>
</html>
