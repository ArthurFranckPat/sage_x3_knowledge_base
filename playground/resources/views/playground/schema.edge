<div class="drawer-header">
  <h2>📊 Schema Explorer</h2>
  <button class="btn-icon" up-dismiss>✕</button>
</div>

<div class="drawer-content">
  <div style="margin-bottom: 1rem;">
    <input 
      type="search" 
      placeholder="Search tables or columns..." 
      style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm);"
      id="schema-search"
      onkeyup="filterSchema(this.value)">
  </div>

  <div id="schema-list">
    @if(tables)
      @each(table in tables)
        <details class="table-item" style="margin-bottom: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 0.75rem;">
          <summary style="cursor: pointer; font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
            <span>🗂️ {{ table.name }}</span>
            <span style="font-size: 0.875rem; color: var(--text-secondary);">{{ table.columns.length }} columns</span>
          </summary>
          
          <div style="margin-top: 0.75rem; padding-left: 1rem;">
            @each(column in table.columns)
              <div 
                class="column-item" 
                style="padding: 0.5rem; margin: 0.25rem 0; background: var(--bg-tertiary); border-radius: var(--border-radius-sm); font-family: var(--font-mono); font-size: 0.875rem; cursor: pointer;"
                onclick="copyColumnName('{{ table.name }}.{{ column.name }}')"
                title="Click to copy">
                <strong>{{ column.name }}</strong>
                <span style="color: var(--text-secondary);"> : {{ column.type }}</span>
                @if(!column.nullable)
                  <span style="color: var(--color-error); font-size: 0.75rem;"> NOT NULL</span>
                @end
              </div>
            @end
          </div>
        </details>
      @end
    @else
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading schema...</p>
      </div>
    @end
  </div>
</div>

<script>
  function filterSchema(query) {
    const items = document.querySelectorAll('.table-item')
    const lowerQuery = query.toLowerCase()
    
    items.forEach(item => {
      const text = item.textContent.toLowerCase()
      item.style.display = text.includes(lowerQuery) ? 'block' : 'none'
    })
  }

  function copyColumnName(name) {
    navigator.clipboard.writeText(name).then(() => {
      showToast(`✓ Copied: ${name}`, 'success')
    })
  }
</script>
